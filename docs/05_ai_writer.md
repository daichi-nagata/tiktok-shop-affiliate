# 05. 投稿文生成機能

## 概要
Claude APIを使用して、商品紹介文とハッシュタグを自動生成する。

## タスク一覧

### Claude API連携
- [x] 投稿文生成用のAPI呼び出し
- [x] プロンプトテンプレートの作成
- [x] レスポンスのパース処理

### 投稿文ルール
- [x] 300文字以内の制限
- [x] PR表記の自動挿入（ステマ規制対応）
- [x] 絵文字の適度な使用（3〜5個）
- [x] ハッシュタグ生成（5〜7個）

### バリエーション
- [x] 複数パターンの文体対応
- [x] 季節・トレンド考慮

## ai_writer.py の実装

### 使用モデル
- `claude-sonnet-4-5-20250929`

### プロンプト設計
```
あなたはTikTokで商品を紹介する人気クリエイターです。
以下の商品について、TikTokフォト投稿用の紹介文を書いてください。

【商品情報】
商品名: {item_name}
価格: {price}円
カテゴリ: {category}
説明: {description}

【ルール】
- 300文字以内
- 絵文字を適度に使用（3〜5個）
- 冒頭に「PR」を入れる（ステマ規制対応）
- 商品の魅力・使用シーンを具体的に
- 呼びかけ調で親しみやすく
- 「TikTok Shopでチェック」など購買を促す一文を入れる

【出力形式】
本文:
（紹介文をここに）

ハッシュタグ:
#タグ1 #タグ2 #タグ3 #タグ4 #タグ5
```

### 関数一覧
- [x] `create_post_prompt(product)` - プロンプト生成
- [x] `generate_post_text(product)` - 投稿文生成
- [x] `parse_response(response)` - レスポンスパース
- [x] `validate_post_text(text)` - 投稿文検証

### 出力形式
```python
{
    "body": "PR\n\n今話題のネックファン...",
    "hashtags": ["#ネックファン", "#夏の必需品", "#TikTokShop", "#便利グッズ", "#暑さ対策"],
    "full_text": "PR\n\n今話題のネックファン...\n\n#ネックファン #夏の必需品..."
}
```

### 文体バリエーション
```python
STYLE_TEMPLATES = [
    "enthusiastic",    # 熱狂的・テンション高め
    "casual",          # カジュアル・友達感覚
    "informative",     # 情報提供型
    "story",           # 体験談風
]
```

## 投稿文の検証ルール

- [x] 文字数が300文字以内か
- [x] 「PR」が含まれているか
- [x] ハッシュタグが5〜7個か
- [x] 不適切な表現がないか

## 完了条件
- [x] 商品情報から投稿文が生成できる
- [x] PR表記が自動で含まれる
- [x] ハッシュタグが適切に生成される
- [x] 文字数制限内に収まる

## 関連ファイル
- `ai_writer.py`
- `config.py`（APIキー）

## 備考
- 投稿文の品質は定期的にチェックして改善
- NG表現のリストを管理（薬事法違反など）
- 同じ商品でも毎回異なる文章を生成
